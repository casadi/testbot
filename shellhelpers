function allowfail() {
        ERR=$?
        for var in "$@"
        do
        if [ $ERR -eq $var ]
        then
                $(exit 0);
                return;
        fi
        done
        $(exit $ERR);
}


function mingw_setup() {
sudo apt-get update -qq
sudo apt-get remove -qq -y mingw32
cat <<EOF | sudo tee --append  /etc/apt/sources.list
    deb-src http://archive.ubuntu.com/ubuntu vivid main restricted universe multiverse
    deb http://archive.ubuntu.com/ubuntu vivid main restricted universe multiverse
EOF
cat <<EOF | sudo tee /etc/apt/preferences.d/mytest
    Package: *
    Pin: release n=trusty
    Pin-priority: 700

    Package: *
    Pin: release n=vivid
    Pin-priority: 600
EOF
sudo apt-get update -qq
sudo apt-get install -q -y -t vivid mingw-w64 
sudo apt-get install -q -y -t vivid mingw-w64 g++-mingw-w64 gcc-mingw-w64 gfortran-mingw-w64 mingw-w64-tools
}


function pinning() {
cat <<EOF | sudo tee --append  /etc/apt/sources.list
    deb-src http://archive.ubuntu.com/ubuntu $1 main restricted universe multiverse
    deb http://archive.ubuntu.com/ubuntu $1 main restricted universe multiverse
EOF
cat <<EOF | sudo tee /etc/apt/preferences.d/mytest
    Package: *
    Pin: release n=trusty
    Pin-priority: 700

    Package: *
    Pin: release n=$1
    Pin-priority: 600
EOF
sudo apt-get update -qq
}

function remote_access() {
  (while true ; do sleep 60 ; echo "ping" ; done ) &
  source /home/travis/build/testbot/restricted/env.sh
  ssh-keyscan $GATE_SERVER >> ~/.ssh/known_hosts
  whoami
  echo "ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA3mEl1i8wiojyJdJnwrmC3RTWCIGgUM4lmtWNWu4p4QyiBry2iB7y2qno48pZqkV/EFRsyWWeEDvbdA4etYlceKZaGJFAdqJig/247qPbamU5W5++d7zkGwA5nQDH147/+JMYk4na9RoGl2iOHMyxi7Wq0WkN11u0Slp2awluvV9UXpBl/XD74eYmUfOFop6y+Hkg/K2hyytg8vAkp33x/vy8JxSK93vbnLGsrVOVjp6Epf7Jo2C8ZHX9eVL2sfi7icjNbt6s9AnU076tBURBIEQbg+Sa8nK7v6zzJNZbn9G85t0M64BKMvcRH1BXf0VvIeBQs/yv9uZLaC9SFvj+4Q== u0052373@xen-vm03.mech.kuleuven.be" >> ~/.ssh/authorized_keys
  ssh -i /home/travis/build/testbot/id_rsa_travis $USER_GATE@$GATE_SERVER -R 19922:localhost:22 -N
}

function test_commit() {
  if [ $TESTCOMMIT ]; then
  git remote add github git@github.com:casadi/binaries.git
  git fetch github
  git checkout $1
  git commit -a -m "automatic test commit $COMMIT" || allowfail 1
  test $(git status --porcelain | grep UU | wc -c) -eq 0
  git push github $1
  fi
}
fi

